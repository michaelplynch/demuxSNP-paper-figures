---
title: "Supp_figures"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Supp_figures}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(demuxSNPpaperfigures)
library(demuxSNP)
```



````{r}

load("/data/projects/demuxSNP/nextflow/ccrcc_out/demuxSNP_h/h_final_sce.rdata")

sce$truth<-gsub("K","Hashtag", sce$truth)
````



````{r}
kvec<-seq(5,100,5)
acc<-c()
for (i in seq_along(kvec)) {
  k<-kvec[i]
  print(k)
  sce$knn<-NULL
  predict<-sce$labels=="uncertain" | sce$labels=="negative"
  sce<-reassign(sce,k=k,d=200,train_cells = sce$train,predict_cells = sce$predict)
  acc[i]<-sum((sce$truth==sce$knn)/length(sce$truth))
}
plot(kvec,acc)
````

````{r}
dvec<-seq(25,750,25)
for (i in seq_along(dvec)) {
  d<-dvec[i]
  print(d)
  sce$knn<-NULL
  sce<-reassign(sce,k=30,d=d,train_cells = sce$train,predict_cells = sce$predict)
  acc[i]<-sum((sce$truth==sce$knn)/length(sce$truth))
}


plot(dvec,acc)
````

````{r}
library(scran)
library(scater)
snp<-altExp(sce,"SNP")
snp$truth<-sce$truth
snp$train<-sce$train
snp$truthalldoub<-sce$truthalldoub
snp<-snp[,snp$train]
df<-data.frame(colData(snp))
df$cellnames<-rownames(df)
new_df <- df %>% group_by(truth) %>% slice_sample(n=500)
snp<-snp[,colnames(snp) %in% new_df$cellnames]
table(snp$truth)
snp<-runPCA(snp,exprs_values="counts")
snp<-runTSNE(snp,dimred="PCA")
size=0.2
dittoDimPlot(snp,reduction.use="PCA","truth",size = size)
dittoDimPlot(snp,reduction.use="TSNE","truth",size = size)
dittoDimPlot(snp,reduction.use="TSNE","truthalldoub",size = size)

dittoDimPlot(snp,reduction.use="PCA","truth",split.by = "truth",size = size)
dittoDimPlot(snp,reduction.use="TSNE","truth",split.by = "truth", size = size)
````

