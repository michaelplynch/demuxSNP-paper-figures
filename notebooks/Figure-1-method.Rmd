---
title: "Figure-1-method"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Figure-1-method}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(demuxSNPpaperfigures)
```

````{r fig.height=2.5,fig.width=3.5}
set.seed(3)
dfa<-data.frame(x=rnorm(5,mean=0.95,sd=0.05),y=rnorm(5,mean=0.05,sd=0.05),sample="Hashtag1")
dfb<-data.frame(x=rnorm(4,mean=0.05,sd=0.05),y=rnorm(4,mean=0.95,sd=0.05),sample="Hashtag2")
#dfc<-data.frame(x=rnorm(5,mean=0.95,sd=0.05),y=rnorm(5,mean=0.95,sd=0.05),sample="c")
df_tot<-rbind(dfa,dfb)
df_tot$sample[9]<-"uncertain"
gg<-ggpar(ggscatter(df_tot,x="x",y="y",color = "sample",palette=c(dittoColors()[1:2],"#808080"),label='sample',repel = TRUE),xlab="SNP1",ylab="SNP2")
gg
gg+ rremove('legend') + scale_x_continuous(n.breaks=2)+ scale_y_continuous(n.breaks=2)




````






````{r fig.width=12,fig.height=3}
source("../R/hto_sim.R")
source("../R/plot_hashtag.R")

````

````{r fig.height=4, fig.width=5.5}
library(dittoSeq)
library(ggpubr)
mat<-logimat(2,c(800,800),0,0)

size_sig=rep(3.5,2)
size_bg=rep(7,7)
mu_sig=c(1400,600)
mu_bg=c(110,120)
params<-c(size_sig,size_bg,mu_sig,mu_bg)
counts<-draw_counts(size_sig = size_sig, size_bg = size_bg, mu_sig = mu_sig, mu_bg = mu_bg, mat = mat)

library(Seurat)
norm<-NormalizeData(counts,normalization.method="CLR")
split1=c(rep(TRUE,800),rep(FALSE,800))
split2<-!split1
split<-rbind(split1,split2)
p<-plot_hashtag(as.data.frame(t(norm)),ylim=c(0,350),xlim=c(0,3),split=split)

p[[1]] / p[[2]]


````


````{r}

lgd = Legend(at = c("Hashtag1 signal","Hashtag2 signal","Background staining"), title = "HTO distribution", legend_gp = gpar(fill = c(dittoColors()[1:2],'#808080')),ncol=1)
draw(lgd,test="")

````
